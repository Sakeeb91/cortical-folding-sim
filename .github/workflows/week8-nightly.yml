name: Week8 Nightly Hardened Validation

on:
  schedule:
    - cron: "0 3 * * *"
  workflow_dispatch:

permissions:
  contents: read

concurrency:
  group: week8-nightly-validation
  cancel-in-progress: false

jobs:
  week8-hardened-validation:
    runs-on: ubuntu-latest
    timeout-minutes: 60
    env:
      MPLBACKEND: Agg
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: "3.11"
      - name: Install ffmpeg
        run: |
          sudo apt-get update
          sudo apt-get install -y ffmpeg
      - name: Install project
        run: python3.11 -m pip install -e ".[dev]"
      - name: Run Week 8 hardened validation
        run: python3.11 scripts/validate_week8_hardened.py --n-steps 140
      - name: Upload Week 8 validation report
        uses: actions/upload-artifact@v4
        with:
          name: week8-hardened-validation-report
          path: results/week8_hardened_validation.json
